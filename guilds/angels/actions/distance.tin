#action {^Di: |{-*}{M|P}{-*}{M|P}{-*}|} {
  #var angel[distance] @length{%3};

  #if {@length{%3} > 0 && "$disengaging" == "false"} {
    !engage;
    #math {angel[distance]} {@length{%3} - 1};
  }

  #regexp {%0} {|P} {#var can_disengage false} {#var can_disengage true};
  #regexp {%0} {P|} {#var can_disengage false} {#var can_disengage true};
}
